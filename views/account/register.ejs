<section class="auth-card" aria-labelledby="register-title">
  <h1 id="register-title"><%= title %></h1>

  <% const flashMessages = messages(); %>
  <% if (flashMessages.trim()) { %>
    <div class="auth-card__messages">
      <%- flashMessages %>
    </div>
  <% } %>

  <% if (errors) { %>
    <ul class="notice">
      <% errors.array().forEach(error => { %>
        <li><%= error.msg %></li>
      <% }) %>
    </ul>
  <% } %>

  <form class="auth-form" action="/account/register" method="post">
    <div class="form-group">
      <label for="account_firstname">First name</label>
      <input
        type="text"
        id="account_firstname"
        name="account_firstname"
        autocomplete="given-name"
        required
        value="<%= locals.account_firstname %>"
      >
    </div>

    <div class="form-group">
      <label for="account_lastname">Last name</label>
      <input
        type="text"
        id="account_lastname"
        name="account_lastname"
        autocomplete="family-name"
        required
        value="<%= locals.account_lastname %>"
      >
    </div>

    <div class="form-group">
      <label for="account_email">Email address</label>
      <input
        type="email"
        id="account_email"
        name="account_email"
        autocomplete="email"
        required
        value="<%= locals.account_email %>"
      >
    </div>

    <div class="form-group password-group">
      <label for="account_password">Password</label>
      <div class="password-input">
        <input
          type="password"
          id="account_password"
          name="account_password"
          autocomplete="new-password"
          aria-describedby="password-hint"
          required
          pattern="^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[^a-zA-Z0-9])(?!.*\s).{12,}$"
        >
        <button
          type="button"
          class="password-toggle"
          data-toggle-target="account_password"
          aria-label="Show password"
        >
          Show
        </button>
      </div>
      <div id="password-hint" class="form-hint password-requirements" role="note">
        Passwords must be at least 12 characters and contain at least one uppercase letter, one lowercase letter, one number, and one special character.
      </div>
    </div>

    <button class="button-primary" type="submit">Create account</button>
  </form>
</section>

<script>
  (() => {
    const toggleButton = document.querySelector(".password-toggle")
    if (!toggleButton) return

    const targetInput = document.getElementById(toggleButton.dataset.toggleTarget)
    if (!targetInput) return

    const toggleVisibility = () => {
      const isPassword = targetInput.getAttribute("type") === "password"
      targetInput.setAttribute("type", isPassword ? "text" : "password")
      toggleButton.textContent = isPassword ? "Hide" : "Show"
      toggleButton.setAttribute("aria-label", isPassword ? "Hide password" : "Show password")
    }

    toggleButton.addEventListener("click", toggleVisibility)
  })()
</script>